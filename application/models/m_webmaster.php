<?phpif (!defined('BASEPATH'))    exit('No direct script access allowed');class M_webmaster extends CI_Model {    function M_webmaster() {        parent::__construct();    }    //fungsi ambil data !    function Ambil_data($tabel) {        $q = $this->db->get($tabel);        return $q;    }    //fungsi get data bebas lab    function get_data_bebas_lab($id) {        $q = $this->db->query("select NIM from LAB_D_BEBAS_LAB WHERE NO_BEBAS_LAB='$id'");        return $q;    }    //fungsi cek jumlah sks    function cek_sks($nim) {        $q = $this->db->query("select sum(SKS) as jum_sks from D_TRANSKRIP WHERE NIM='$nim'");        return $q;    }        //cek sudah ngambil TA apa blm    function cek_ta($nim) {        $q = $this->db->query("SELECT A.KD_MK, B.NM_MK , B.NM_MK_SINGKAT                                FROM D_TRANSKRIP_HISTORI A                                INNER JOIN MD_MATAKULIAH_KUR_PRODI B                                ON A.KD_MK=B.KD_MK                                WHERE A.NIM='$nim' AND                                A.KD_MK IN (                                SELECT A.KD_MK                                FROM MD_MATAKULIAH_KUR_PRODI A                                INNER JOIN MASTER_PRODI B                                ON A.KD_PRODI=B.KD_PRODI                                WHERE UPPER(NM_MK_SINGKAT) LIKE '%SKRIP%' OR                                UPPER(NM_MK)='TUGAS AKHIR'                                )");        return $q;    }    function Ambil_data_mhs_nim($nim) {        $q = $this->db->query("SELECT a.NIM, a.NAMA,  c.NM_PRODI,c.KD_PRODI,e.NM_FAK FROM D_MAHASISWA a, MASTER_PRODI c, MASTER_JURUSAN d, MASTER_FAK e where a.NIM='$nim' and a.KD_PRODI=c.KD_PRODI and c.KD_JURUSAN=d.KD_JURUSAN and d.KD_FAK=e.KD_FAK");        return $q;    }    function  get_date_now()    {        $q = $this->db->query("SELECT TO_DATE(sysdate, 'DD-MON-YY') FROM DUAL");        return $q;    }    function  get_month_now()    {        $q = $this->db->query("SELECT TO_DATE(sysdate, 'MON-YY') FROM DUAL");        return $q;    }    //fungsi Ambil data NIM, NAMA, PRODI utk dicetak    function Ambil_data_mhs($id) {        $q = $this->db->query("SELECT a.NIM, a.NAMA, b.NO_BEBAS_LAB, b.TGL_BEBAS, b.TGL_BAYAR, b.STATUS_BEBAS, c.NM_PRODI,c.KD_PRODI FROM D_MAHASISWA a, LAB_D_BEBAS_LAB b, MASTER_PRODI c where a.NIM=b.NIM and a.KD_PRODI=c.KD_PRODI AND b.NO_BEBAS_LAB='$id'");        return $q;    }    //fungsi mengambil pegawai keuangan    //    function get_pegawai_tu()    {        $q = $this->db->query("SELECT a.NO_PEG, a.NIP, NM_PEG, b.NO_JABATAN, b.STATUS, c.NM_JABATAN, c.KD_JABATAN FROM LAB_D_PEGAWAI_LAB a, LAB_D_JABATAN_AKTIF b, LAB_D_JABATAN_LAB c WHERE a.NO_PEG=b.NO_PEG and b.KD_JABATAN=c.KD_JABATAN AND b.KD_JABATAN='21' ORDER BY b.NO_JABATAN");        return $q;    }    //get pegawai tu where NO_Jabatan =     function get_pegawai_tu_where($nojabatan)    {        $q = $this->db->query("SELECT a.NO_PEG, a.NIP, NM_PEG, b.NO_JABATAN, b.STATUS, c.NM_JABATAN, c.KD_JABATAN FROM LAB_D_PEGAWAI_LAB a, LAB_D_JABATAN_AKTIF b, LAB_D_JABATAN_LAB c WHERE a.NO_PEG=b.NO_PEG and b.KD_JABATAN=c.KD_JABATAN AND b.KD_JABATAN='21' AND b.NO_JABATAN='$nojabatan'");        return $q;    }    //ambil data ppl    function get_ppl($kode) {        $q = $this->db->query("SELECT a.KD_PRODI, a.NM_JABATAN, a.KD_JABATAN, b.KD_JABATAN, b.NO_PEG, c.NM_PEG, c.NIP FROM LAB_D_JABATAN_LAB a, LAB_D_JABATAN_AKTIF b, LAB_D_PEGAWAI_LAB c WHERE a.KD_JABATAN=b.KD_JABATAN AND b.NO_PEG=c.NO_PEG AND a.KD_PRODI='$kode' ORDER BY c.NM_PEG");        return $q;    }    //fungsi ngambil nama dan nip direktur lab    function get_dirut() {        $q = $this->db->query("SELECT a.KD_PRODI, a.NM_JABATAN, a.KD_JABATAN, b.KD_JABATAN, b.NO_PEG, c.NM_PEG, c.NIP FROM LAB_D_JABATAN_LAB a, LAB_D_JABATAN_AKTIF b, LAB_D_PEGAWAI_LAB c WHERE a.KD_JABATAN=b.KD_JABATAN AND b.NO_PEG=c.NO_PEG AND a.KD_JABATAN='12'");        return $q;    }    //fungsi ambil data pegawai    function Ambil_data_pegawai($offset, $limit) {        $q = $this->db->query("SELECT * FROM (SELECT K.*, ROWNUM rnum FROM                         (SELECT * FROM LAB_D_PEGAWAI_LAB ORDER BY NO_PEG) K                        WHERE ROWNUM <= $limit) WHERE rnum > $offset");        return $q;    }    //fungsi ambil data jabatan pegawai aktif    function Ambil_jabatan($offset, $limit) {        $q = $this->db->query("SELECT * FROM (SELECT K.*, ROWNUM rnum FROM                         (SELECT a.NO_PEG, a.NIP, NM_PEG, b.NO_JABATAN, c.NM_JABATAN, c.KD_JABATAN FROM LAB_D_PEGAWAI_LAB a, LAB_D_JABATAN_AKTIF b, LAB_D_JABATAN_LAB c WHERE a.NO_PEG=b.NO_PEG and b.KD_JABATAN=c.KD_JABATAN ORDER BY NO_PEG) K                        WHERE ROWNUM <= $limit) WHERE rnum > $offset ORDER BY NM_JABATAN DESC");        return $q;    }    //fungsi ambil data Permintaan Surat Bebas Lab    function Ambil_request_admin($offset, $limit) {        $q = $this->db->query("SELECT * FROM (SELECT K.*, ROWNUM rnum FROM                         (SELECT a.NIM, a.NAMA, b.NO_BEBAS_LAB, TO_CHAR(b.TGL_BAYAR,'DD MONTH YYYY') AS TGL_BAYAR, b.STATUS_BEBAS, c.NM_PRODI FROM D_MAHASISWA a, LAB_D_BEBAS_LAB b, MASTER_PRODI c where a.NIM=b.NIM and a.KD_PRODI=c.KD_PRODI AND b.STATUS_BEBAS='0' ORDER BY b.NO_BEBAS_LAB DESC) K                        WHERE ROWNUM <= $limit) WHERE rnum > $offset ORDER BY NO_BEBAS_LAB DESC");        return $q;    }    //fungsi ambil data Permintaan Surat Bebas Lab    function Ambil_request($offset, $limit) {        $q = $this->db->query("SELECT * FROM (SELECT K.*, ROWNUM rnum FROM                         (SELECT a.NIM, a.NAMA, b.NO_BEBAS_LAB, TO_CHAR(b.TGL_BAYAR,'DD MONTH YYYY') AS TGL_BAYAR, b.STATUS_BEBAS, c.NM_PRODI FROM D_MAHASISWA a, LAB_D_BEBAS_LAB b, MASTER_PRODI c where a.NIM=b.NIM and a.KD_PRODI=c.KD_PRODI ORDER BY b.NO_BEBAS_LAB DESC) K                        WHERE ROWNUM <= $limit) WHERE rnum > $offset ORDER BY NO_BEBAS_LAB DESC");        return $q;    }    //fungsi ambil data Histori Surat Bebas Lab    function Ambil_history($offset, $limit) {        $q = $this->db->query("SELECT * FROM (SELECT K.*, ROWNUM rnum FROM                         (SELECT a.NIM, a.NAMA, b.NO_BEBAS_LAB, b.TGL_BAYAR,b.JAM_BAYAR, b.JAM_BEBAS, b.TGL_BEBAS, c.NM_PRODI, e.NM_FAK FROM D_MAHASISWA a, LAB_D_BEBAS_LAB b, MASTER_PRODI c, MASTER_JURUSAN d, MASTER_FAK e where a.NIM=b.NIM and a.KD_PRODI=c.KD_PRODI and c.KD_JURUSAN=d.KD_JURUSAN and d.KD_FAK=e.KD_FAK and b.STATUS_BEBAS='1' ORDER BY b.NO_BEBAS_LAB DESC) K                        WHERE ROWNUM <= $limit) WHERE rnum > $offset");        return $q;    }    //fungsi ambil data Siap Cetak Surat Bebas Lab    function Ambil_cetak($offset, $limit) {        $q = $this->db->query("SELECT * FROM (SELECT K.*, ROWNUM rnum FROM                         (SELECT a.NIM, a.NAMA, b.NO_BEBAS_LAB, b.TGL_BAYAR,b.JAM_BAYAR, b.TGL_BEBAS, b.STATUS_BEBAS, c.NM_PRODI, e.NM_FAK FROM D_MAHASISWA a, LAB_D_BEBAS_LAB b, MASTER_PRODI c, MASTER_JURUSAN d, MASTER_FAK e where a.NIM=b.NIM and b.STATUS_BEBAS='0' and a.KD_PRODI=c.KD_PRODI and c.KD_JURUSAN=d.KD_JURUSAN and d.KD_FAK=e.KD_FAK ORDER BY b.NO_BEBAS_LAB DESC) K                        WHERE ROWNUM <= $limit) WHERE rnum > $offset ORDER BY NO_BEBAS_LAB DESC");        return $q;    }    //fungsi ambil data Siap Cetak Surat Bebas Lab    function Ambil_cetak_cari($cari) {        $q = $this->db->query("SELECT a.NIM, a.NAMA, b.NO_BEBAS_LAB, b.TGL_BAYAR, b.TGL_BEBAS, b.STATUS_BEBAS, c.NM_PRODI FROM D_MAHASISWA a, LAB_D_BEBAS_LAB b, MASTER_PRODI c where a.NIM=b.NIM and a.KD_PRODI=c.KD_PRODI and b.NIM like '%$cari%' ORDER BY b.NO_BEBAS_LAB");        return $q;    }    //fungsi ambil data laporan keuangan Surat Bebas Lab    function Ambil_laporan($offset, $limit) {        $q = $this->db->query("SELECT * FROM (SELECT K.*, ROWNUM rnum FROM                         (SELECT b.NO_TRANSAKSI, a.NIM, a.NAMA, c.NM_PRODI, b.TGL_BAYAR, b.JAM_BAYAR, b.JUMLAH FROM D_MAHASISWA a, LAB_D_TRANSAKSI_LAB b, MASTER_PRODI c where a.NIM=b.NIM and a.KD_PRODI=c.KD_PRODI ORDER BY b.NO_TRANSAKSI DESC) K                        WHERE ROWNUM <= $limit) WHERE rnum > $offset ORDER BY NO_TRANSAKSI DESC");        return $q;    }    //fungsi ambil data laporan keuangan Surat Bebas Lab    function Ambil_laporan_semua() {        $q = $this->db->query("SELECT b.NO_TRANSAKSI, a.NIM, a.NAMA, c.NM_PRODI, b.TGL_BAYAR, b.JAM_BAYAR, b.JUMLAH FROM D_MAHASISWA a, LAB_D_TRANSAKSI_LAB b, MASTER_PRODI c where a.NIM=b.NIM and a.KD_PRODI=c.KD_PRODI ORDER BY b.NO_TRANSAKSI DESC");        return $q;    }        //fungsi ambil data laporan keuangan Surat Bebas Lab    function Ambil_laporan_filter($offset, $limit,$tgl) {        $q = $this->db->query("SELECT * FROM (SELECT K.*, ROWNUM rnum FROM                         (SELECT b.NO_TRANSAKSI, a.NIM, a.NAMA, c.NM_PRODI, b.TGL_BAYAR, b.JAM_BAYAR, b.JUMLAH FROM D_MAHASISWA a, LAB_D_TRANSAKSI_LAB b, MASTER_PRODI c where a.NIM=b.NIM and a.KD_PRODI=c.KD_PRODI AND b.TGL_BAYAR like UPPER('%$tgl%') ORDER BY b.NO_TRANSAKSI DESC) K                        WHERE ROWNUM <= $limit) WHERE rnum > $offset ORDER BY NO_TRANSAKSI DESC");        return $q;    }    //fungsi ambil data laporan keuangan Surat Bebas Lab    function Ambil_laporan_hariini($tgl) {        $q = $this->db->query("SELECT b.NO_TRANSAKSI, a.NIM, a.NAMA, c.NM_PRODI, b.TGL_BAYAR, b.JAM_BAYAR, b.JUMLAH FROM D_MAHASISWA a, LAB_D_TRANSAKSI_LAB b, MASTER_PRODI c where a.NIM=b.NIM and a.KD_PRODI=c.KD_PRODI AND b.TGL_BAYAR like UPPER('%$tgl%') ORDER BY b.NO_TRANSAKSI DESC");        return $q;    }      //fungsi ambil data laporan keuangan Surat Bebas Lab dengan filter tgl mulai&akhir    function Ambil_laporan_custom($tgl1,$tgl2) {        $q = $this->db->query("SELECT b.NO_TRANSAKSI, a.NIM, a.NAMA, c.NM_PRODI, b.TGL_BAYAR, b.JAM_BAYAR, b.JUMLAH FROM D_MAHASISWA a, LAB_D_TRANSAKSI_LAB b, MASTER_PRODI c where a.NIM=b.NIM and a.KD_PRODI=c.KD_PRODI AND b.TGL_BAYAR BETWEEN TO_DATE('$tgl1','yyyy-mm-dd') AND TO_DATE('$tgl2','yyyy-mm-dd') ORDER BY b.NO_TRANSAKSI DESC");        return $q;    }    //fungsi ambil data laporan keuangan Surat Bebas Lab dengan filter tgl mulai&akhir    function Ambil_laporan_filter_tgl($offset, $limit,$tgl1,$tgl2) {        $q = $this->db->query("SELECT * FROM (SELECT K.*, ROWNUM rnum FROM                         (SELECT b.NO_TRANSAKSI, a.NIM, a.NAMA, c.NM_PRODI, b.TGL_BAYAR, b.JAM_BAYAR, b.JUMLAH FROM D_MAHASISWA a, LAB_D_TRANSAKSI_LAB b, MASTER_PRODI c where a.NIM=b.NIM and a.KD_PRODI=c.KD_PRODI AND b.TGL_BAYAR BETWEEN TO_DATE('$tgl1','yyyy-mm-dd') AND TO_DATE('$tgl2','yyyy-mm-dd') ORDER BY b.NO_TRANSAKSI DESC) K WHERE ROWNUM <= $limit) WHERE rnum > $offset ORDER BY NO_TRANSAKSI DESC");        return $q;    }    //fungsi data Total_bebas_lab yang sudah siap cetak    function Total_bebas_lab_cetak() {        $q = $this->db->query("select * from LAB_D_BEBAS_LAB where STATUS_BEBAS='0'");        return $q;    }    //fungsi data Total_bebas_lab yang sudah siap cetak Pencarian    function Total_bebas_lab_cetak_cari($cari) {        $q = $this->db->query("");        return $q;    }    //fungsi data Total_bebas_lab yang merequest data    function Total_bebas_lab_request() {        $q = $this->db->query("select * from LAB_D_BEBAS_LAB where STATUS_BEBAS='0'");        return $q;    }    //fungsi data Total_bebas_lab yang merequest data utk keuangan    function Total_keuangan_request() {        $q = $this->db->query("select * from LAB_D_BEBAS_LAB");        return $q;    }       //jumlah bebas lab yang sudah lunas    function Total_bebas_lab() {        $q = $this->db->query("select * from LAB_D_BEBAS_LAB where STATUS_BEBAS='1'");        return $q;    }        //fungsi total data    function Total_data_laporan($tgl) {        $q = $this->db->query("select * from LAB_D_TRANSAKSI_LAB where TGL_BAYAR like UPPER('%$tgl%')");        return $q;    }    //fungsi total data laporan tanggal awal-akhir    function Total_data_laporan_tgl($tgl1,$tgl2) {        $q = $this->db->query("select * from LAB_D_TRANSAKSI_LAB where TGL_BAYAR BETWEEN TO_DATE('$tgl1','yyyy-mm-dd') AND TO_DATE('$tgl2','yyyy-mm-dd')");        return $q;    }      //fungsi jumlah uang pemasukan dg filter    function Jml_uang($tgl) {        $q = $this->db->query("select sum(JUMLAH) as TOTAL from LAB_D_TRANSAKSI_LAB where TGL_BAYAR like UPPER('%$tgl%')");        return $q;    }       //fungsi jumlah uang pemasukan dg filter tgl awal-akhir    function Jml_uang_tgl($tgl1,$tgl2) {        $q = $this->db->query("select sum(JUMLAH) as TOTAL from LAB_D_TRANSAKSI_LAB where TGL_BAYAR BETWEEN TO_DATE('$tgl1','yyyy-mm-dd') AND TO_DATE('$tgl2','yyyy-mm-dd')");        return $q;    }     //fungsi jumlah semau uang pemasukan    function Jml_laporan() {        $q = $this->db->query("select sum(JUMLAH) as TOTAL from LAB_D_TRANSAKSI_LAB");        return $q;    }    //fungsi total data    function Total_data($tabel) {        $q = $this->db->query("select * from $tabel");        return $q;    }    //fungsi Hapus data    function Delete_data($id, $seleksi, $tabel) {        $this->db->where($seleksi, $id);        $this->db->delete($tabel);    }    //fungsi update data    function Update_data($tabel, $isi, $seleksi) {        $this->db->where($seleksi, $isi[$seleksi]);        $this->db->update($tabel, $isi);    }    //fungsi edit data    function Edit_data($tabel, $seleksi) {        $query = $this->db->query("select * from $tabel where $seleksi");        return $query;    }    //insert data pegawai    function Input_pegawai($nip, $nm, $tgl, $tmp, $email, $telp, $alamat) {        $input = $this->db->query("insert into LAB_D_PEGAWAI_LAB(NIP,NM_PEG,TMP_LAHIR,TGL_LAHIR,EMAIL,TELP,ALAMAT) values ('$nip','$nm','$tmp',TO_DATE('$tgl','DDMMYY'),'$email','$telp','$alamat')");        return $input;    }    //update data pegawai    function Update_pegawai($nip, $nm, $tgl, $tmp, $email, $telp, $alamat, $id) {        $input = $this->db->query("update LAB_D_PEGAWAI_LAB set NIP='$nip', NM_PEG='$nm', TMP_LAHIR='$tmp', TGL_LAHIR=TO_DATE('$tgl','DDMMYY'), EMAIL='$email', TELP='$telp', ALAMAT='$alamat' where NO_PEG='$id'");        return $input;    }        //update status pegawai keuangan    function Update_status_pegawai_tu($status, $id) {        $input = $this->db->query("update LAB_D_JABATAN_AKTIF set STATUS='$status' where NO_JABATAN='$id'");        return $input;    }    //fungsi get pegawaitu    //    function get_pegawaitu()    {        $input = $this->db->query("SELECT a.NO_PEG, a.NIP, NM_PEG, b.NO_JABATAN, b.STATUS, c.NM_JABATAN, c.KD_JABATAN FROM LAB_D_PEGAWAI_LAB a, LAB_D_JABATAN_AKTIF b, LAB_D_JABATAN_LAB c WHERE a.NO_PEG=b.NO_PEG and b.KD_JABATAN=c.KD_JABATAN AND b.KD_JABATAN='21' AND b.STATUS='1'");        return $input;    }    //update data pegawai    function Edit_pegawai($id) {        $input = $this->db->query("select NO_PEG,NIP,NM_PEG,TMP_LAHIR,EMAIL,TELP,ALAMAT, TO_CHAR(TGL_LAHIR,'DDMMYY') as TGL from LAB_D_PEGAWAI_LAB where NO_PEG='$id'");        return $input;    }    //fungsi simpan Data    function Simpan_data($tabel, $data) {        $s = $this->db->insert($tabel, $data);        return $s;    }    //update status Bebas Lab    function Update_status_lab($id) {        $s = $this->db->query("Update LAB_D_BEBAS_LAB set STATUS_BEBAS='1', TGL_BEBAS=sysdate, JAM_BEBAS=to_char(sysdate,'hh24:mi:ss') where NO_BEBAS_LAB='$id'");        return $s;    }    //fungsi simpan bebas lab    function Simpan_data_bebas_lab($nim)    {        $s = $this->db->query("INSERT INTO LAB_D_BEBAS_LAB(NIM,TGL_BAYAR,JAM_BAYAR,STATUS_BEBAS) values('$nim',sysdate,to_char(sysdate,'hh24:mi:ss'),0)");        return $s;    }    //fungsi  Simpan_data_keuangan    function Simpan_data_keuangan($nim,$jml)    {        $s = $this->db->query("INSERT INTO LAB_D_TRANSAKSI_LAB(NIM,TGL_BAYAR,JAM_BAYAR,JUMLAH) values('$nim',sysdate,to_char(sysdate,'hh24:mi:ss'),'$jml')");        return $s;    }               //update cetak Bebas Lab    function Update_cetak_surat($tgl, $id) {        $s = $this->db->query("Update LAB_D_BEBAS_LAB set CETAK='Y', TGL_CETAK='$tgl' where NO_BEBAS_LAB='$id'");        return $s;    }    //update Sudah Bayar Bebas Lab    function Update_bayar_lab($id) {        $s = $this->db->query("Update LAB_D_BEBAS_LAB set STATUS='1', BAYAR='SUDAH' where NO_BEBAS_LAB='$id'");        return $s;    }    //setting biaya surat bebas lab..    function biaya_lab() {        $s = $this->db->query("select * from LAB_D_BIAYA_LAB where NO_BIAYA='15'");        return $s;    }    //update status Biaya Bebas Lab    function Update_biaya_lab($jml, $id) {        $s = $this->db->query("Update LAB_D_BIAYA_LAB set JUMLAH='$jml' where NO_BIAYA='$id'");        return $s;    }    //fungsi untuk login    function login($data) {        $username = $data['USERNAME'];        $pass = $data['PASSWORD'];        $query = $this->db->query("select * from LAB_D_ADMIN_LAB where USERNAME='$username' and PASSWORD='$pass'");        if ($query->num_rows > 0) {            $row = $query->row();            $data['id_user'] = $row->ID_ADMIN;            $data['status'] = $row->STATUS;            $data['nama'] = $row->NAMA;            $data['username'] = $row->USERNAME;            return $data;        }        else            return false;    }        //fungsi untuk login webservice    function login_service($nip) {        //$username = $data['USERNAME'];        //$pass = $data['PASSWORD'];        $query = $this->db->query("SELECT * FROM PENGGUNA WHERE NIP='$nip' AND STATUS='1'");        if ($query->num_rows > 0) {            $row = $query->row();            $data['id_user'] = $row->NIP;            $data['level'] = $row->P_LEVEL;                       return $data;        }        else            return false;    }        function get_mhs()    {        $s = $this->db->query("select NIM,NAMA from D_MAHASISWA where NIM LIKE '0965%'");        return $s;    }        function get_mhs_lab()    {        $s = $this->db->query("select NIM from LAB_D_BEBAS_LAB");        return $s;    }}/* End of file m_webmaster.php *//* Location: ./application/models/m_webmaster.php */